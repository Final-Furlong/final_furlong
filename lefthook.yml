# EXAMPLE USAGE:
#
#   Refer for explanation to following link:
#   https://github.com/evilmartians/lefthook/blob/master/docs/full_guide.md
#
pre-commit:
  skip:
    - merge
    - rebase
  parallel: true
  commands:
    actionlint:
      tags: linter
      files: git diff --name-only --staged
      run: actionlint
    annotate-controllers:
      tags: backend
      files: git diff --name-only --staged
      glob: app/controllers/**/*.rb
      run: bundle exec annotaterb routes && git add {staged_files}
    active-record-doctor:
      tags: linter
      files: git diff --name-only --staged
      run: bundle exec rake active_record_doctor
    eslint:
      tags: frontend style
      glob: "*.{js,ts,jsx,tsx}"
      run: yarn eslint --fix {staged_files} && git add {staged_files}
    fasterer:
      tags: backend style
      files: git diff --name-only --staged
      glob: "*.rb"
      run: fasterer {files}
    i18n-check:
      tags: backend style
      files: git diff --name-only --staged
      glob: config/locales/**/*.yml
      run: bundle exec i18n-tasks normalize && git add {staged_files}
    image_optim:
      tags: backend performance
      files: git diff --name-only --staged
      glob: "*.{jpg,jpeg,gif,png,svg"
      run: image_optim {staged_files} && git add {staged_files}
    rubocop:
      tags: backend style
      files: git diff --name-only --staged
      glob: "*.rb"
      run: rubocop --force-exclusion --autocorrect --server {files} && git add {staged_files}
    slim-lint:
      tags: frontend style
      files: git diff --name-only --staged
      glob: "*.slim"
      run: SLIM_LINT_RUBOCOP_CONF=.rubocop_slim.yml bundle exec slim-lint {files}
    stylelint:
      tags: frontend style
      files: git diff --name-only --staged
      glob: "*.scss"
      run: yarn run stylelint --fix {files} && git add {staged_files}

post-checkout:
  skip:
    - merge
    - rebase
  piped: true
  bundle-install:
    tags: backend
    run: bundle install
  database-migrate:
    tags: backend
    run: rails db:migrate
  data-migrate:
    tags: backend
    run: rails db:migrate:with_data

post-merge:
  skip:
    - merge
    - rebase
  piped: true
  bundle-install:
    tags: backend
    run: bundle install
  database-migrate:
    tags: backend
    run: rails db:migrate
  data-migrate:
    tags: backend
    run: rails db:migrate:with_data

lint:
  commands:
    active-record-doctor:
      run: bundle exec rake active_record_doctor
    annotate-controllers:
      run: bundle exec annotaterb routes
    eslint:
      glob: "*.{js,ts,jsx,tsx}"
      run: yarn eslint {staged_files} --fix
    fasterer:
      run: fasterer
    i18n-check:
      run: bundle exec i18n-tasks health
    rubocop:
      run: bundle exec rubocop --server --autocorrect
    slim-lint:
      run: SLIM_LINT_RUBOCOP_CONF=.rubocop_slim.yml bundle exec slim-lint
    stylelint:
      run: yarn run stylelint --fix app/assets/stylesheets
